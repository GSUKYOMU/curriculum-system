<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì…í•™ì êµìœ¡ê³¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SheetJS -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">

  <!-- ------------ ì—…ë¡œë“œ ë°•ìŠ¤ -------------- -->
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow">
    <h1 class="text-3xl font-bold mb-6 text-center">ì…í•™ì êµìœ¡ê³¼ì • ì—…ë¡œë“œ</h1>

    <!-- í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ -->
    <div class="space-x-2 mb-4">
      <a href="./ì…í•™ìêµìœ¡ê³¼ì •%20ì—…ë¡œë“œ%20í…œí”Œë¦¿.xlsx"
         download="ì…í•™ìêµìœ¡ê³¼ì • ì—…ë¡œë“œ í…œí”Œë¦¿.xlsx"
         class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 inline-block text-sm">
        ğŸ“¥ ì…í•™ìêµìœ¡ê³¼ì • ì—…ë¡œë“œ í…œí”Œë¦¿
      </a>

      <a href="./ì…í•™ìêµìœ¡ê³¼ì •_ë³€ê²½ì‚¬ìœ ì„œ_ê³¼ëª©ë³„_v5.xlsx"
         download="ì…í•™ìêµìœ¡ê³¼ì •_ë³€ê²½ì‚¬ìœ ì„œ_ê³¼ëª©ë³„.xlsx"
         class="bg-amber-500 text-white px-3 py-2 rounded hover:bg-amber-600 inline-block text-sm">
        ğŸ“¥ ì…í•™ìêµìœ¡ê³¼ì • ë³€ê²½ì‚¬ìœ ì„œ(ê³¼ëª©ë³„)
      </a>
    </div>

    <p class="text-xs text-gray-500 mb-2">
      Â· <b>êµìœ¡ê³¼ì • í…œí”Œë¦¿</b> ë˜ëŠ” <b>ë³€ê²½ì‚¬ìœ ì„œ(ê³¼ëª©ë³„)</b> ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.<br>
      Â· êµìœ¡ê³¼ì • í…œí”Œë¦¿ ì‹œíŠ¸ ì´ë¦„: <code>êµìœ¡ê³¼ì •</code>, ë³€ê²½ì‚¬ìœ ì„œ ì‹œíŠ¸ ì´ë¦„: <code>ë³€ê²½ì‚¬ìœ ì„œ</code>
    </p>

    <!-- íŒŒì¼ ì—…ë¡œë“œ -->
    <input id="fileInput" type="file"
           accept=".xlsx,.xls"
           class="border p-3 rounded w-full mb-4"/>

    <button onclick="handleUpload()"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      ì—…ë¡œë“œ
    </button>
  </div>


  <!-- ------------ í•™ê³¼ ë¦¬ìŠ¤íŠ¸ ------------ -->
  <div class="max-w-4xl mx-auto bg-white p-6 mt-8 rounded-xl shadow">
    <h2 class="text-2xl font-semibold mb-4">í•™ê³¼ë³„ êµìœ¡ê³¼ì • ë³´ê¸°</h2>
    <ul id="deptList" class="grid grid-cols-1 md:grid-cols-2 gap-3"></ul>
  </div>


  <!-- ------------ ì—…ë¡œë“œ ê¸°ë¡ í…Œì´ë¸” ------------ -->
  <div class="max-w-4xl mx-auto bg-white p-6 mt-8 rounded-xl shadow">
    <h2 class="text-2xl font-semibold mb-4">ì—…ë¡œë“œ ê¸°ë¡ (êµìœ¡ê³¼ì • í…œí”Œë¦¿ Â· ë³€ê²½ì‚¬ìœ ì„œ)</h2>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm border">
        <thead class="bg-gray-100">
          <tr>
            <th class="border px-2 py-1">í•™ê³¼</th>
            <th class="border px-2 py-1">ì…í•™ë…„ë„</th>
            <th class="border px-2 py-1">ë¬¸ì„œë²ˆí˜¸</th>
            <th class="border px-2 py-1">êµ¬ë¶„</th>
            <th class="border px-2 py-1">ì—…ë¡œë“œì¼</th>
            <th class="border px-2 py-1">ì‚­ì œ</th>
          </tr>
        </thead>
        <tbody id="uploadHistory"></tbody>
      </table>
    </div>
    <p class="mt-2 text-xs text-gray-500">
      * <b>êµìœ¡ê³¼ì • í…œí”Œë¦¿</b>ê³¼ <b>ë³€ê²½ì‚¬ìœ ì„œ(ê³¼ëª©ë³„)</b> ì—…ë¡œë“œ ì´ë ¥ì´ ëª¨ë‘ ê¸°ë¡ë©ë‹ˆë‹¤.<br>
      * ì‚­ì œ ê¸°ëŠ¥ì€ <b>êµìœ¡ê³¼ì • í…œí”Œë¦¿</b>ì˜ ê²½ìš° í•´ë‹¹ ì—°ë„ì˜ êµìœ¡ê³¼ì • ë°ì´í„°ë¥¼ í•¨ê»˜ ì‚­ì œí•˜ë©°,<br>
      &nbsp;&nbsp;&nbsp; <b>ë³€ê²½ì‚¬ìœ ì„œ</b>ì˜ ê²½ìš°ì—ëŠ” ì—…ë¡œë“œ ê¸°ë¡ë§Œ ì‚­ì œë˜ê³ , ì´ë¯¸ ë°˜ì˜ëœ êµìœ¡ê³¼ì • ë³€ê²½ ë‚´ìš©ì€ ìœ ì§€ë©ë‹ˆë‹¤.
    </p>
  </div>



<script>
/* ---------------------------
   í•™ê³¼ ìˆœì„œ
--------------------------- */
const TOP_DEPTS = [
  "ì‹ í•™ê³¼",
  "ì‚¬íšŒë³µì§€í•™ê³¼",
  "ìƒë‹´ì‹¬ë¦¬í•™ê³¼",
  "G2ë¹…ë°ì´í„°ê²½ì˜í•™ê³¼",
  "ì‹¤ìš©ìŒì•…í•™ê³¼",
  "ê°„í˜¸í•™ê³¼",
  "ì‹í’ˆì˜ì–‘í•™ê³¼",
  "ì™¸êµ­ì¸ì „ë‹´í•™ê³¼"
];

const STORAGE_KEY = "curriculumData";
const LOG_STORAGE_KEY = "curriculumUploadLogs";

/* ---------------------------
   ê³µí†µ ì •ê·œí™” í•¨ìˆ˜
--------------------------- */
function clean(v) {
  return (v || "")
    .toString()
    .normalize("NFKC")        // ìœ ë‹ˆì½”ë“œ ì •ê·œí™” (â…  vs I ë“±)
    .replace(/Â /g, " ")  // íŠ¹ìˆ˜ ê³µë°±ì„ ì¼ë°˜ ê³µë°±ìœ¼ë¡œ
    .trim();
}

function same(a, b) {
  return clean(a) === clean(b);
}

/* ---------------------------
   ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
--------------------------- */
function getData() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  } catch (e) {
    return [];
  }
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function getLogs() {
  try {
    return JSON.parse(localStorage.getItem(LOG_STORAGE_KEY) || "[]");
  } catch (e) {
    return [];
  }
}

function saveLogs(logs) {
  localStorage.setItem(LOG_STORAGE_KEY, JSON.stringify(logs));
}

/* ---------------------------
   ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
--------------------------- */
function handleUpload() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) {
    alert("ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
    return;
  }

  const reader = new FileReader();

  reader.onload = e => {
    const wb = XLSX.read(e.target.result, { type: "binary" });

    if (wb.Sheets["êµìœ¡ê³¼ì •"]) {
      processCurriculumSheet(wb.Sheets["êµìœ¡ê³¼ì •"]);
    } else if (wb.Sheets["ë³€ê²½ì‚¬ìœ ì„œ"]) {
      processChangeSheet(wb.Sheets["ë³€ê²½ì‚¬ìœ ì„œ"]);
    } else {
      alert("ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹ì…ë‹ˆë‹¤.\nì‹œíŠ¸ ì´ë¦„ì´ 'êµìœ¡ê³¼ì •' ë˜ëŠ” 'ë³€ê²½ì‚¬ìœ ì„œ'ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
  };

  reader.readAsBinaryString(file);
}

/* ---------------------------
   1) ì…í•™ì êµìœ¡ê³¼ì • í…œí”Œë¦¿ ì²˜ë¦¬
--------------------------- */
function processCurriculumSheet(sh) {
  const rows = XLSX.utils.sheet_to_json(sh, { header: 1 });

  const meta = {
    dept: clean(rows[0]?.[1]),
    year: clean(rows[1]?.[1]),
    docNum: clean(rows[2]?.[1]),
    revDocNum: clean(rows[3]?.[1]),
    approved: clean(rows[4]?.[1]) === "í™•ì •",
    meetingDate: clean(rows[5]?.[1])
  };

  if (!meta.dept || !meta.year || !meta.docNum) {
    alert("í•™ê³¼ëª…, ì…í•™ë…„ë„, ë¬¸ì„œë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
    return;
  }

  // í‘œ í—¤ë” ìœ„ì¹˜ ì°¾ê¸°
  let start = -1;
  for (let i = 0; i < rows.length; i++) {
    if (rows[i][0] === "ê°œì„¤í•™ë…„") {
      start = i;
      break;
    }
  }

  if (start === -1) {
    alert("í‘œ í—¤ë”(ê°œì„¤í•™ë…„)ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
    return;
  }

  const headers = rows[start];
  const dataRows = rows
    .slice(start + 1)
    .filter(r => r.some(c => c !== undefined && c !== null && c !== ""));

  const curriculum = dataRows.map(r => {
    const obj = {};
    headers.forEach((h, i) => obj[h] = r[i] ?? "");
    return obj;
  });

  let all = getData();

  // ì´ì „ ë¬¸ì„œì™€ ë¹„êµ(ìˆë‹¤ë©´)
  let prev = null;
  if (meta.revDocNum) {
    prev = all.find(d => d.dept === meta.dept && d.docNum === meta.revDocNum);
  }
  const changes = prev ? compare(prev.data || [], curriculum) : null;

  const entry = {
    ...meta,
    data: curriculum,
    changes,
    uploadDate: new Date().toISOString()
  };

  // ê°™ì€ í•™ê³¼Â·ë¬¸ì„œë²ˆí˜¸ ê¸°ì¡´ ë°ì´í„° ì œê±° í›„ ì¶”ê°€
  all = all.filter(d => !(d.dept === meta.dept && d.docNum === meta.docNum));
  all.push(entry);
  saveData(all);

  // ì—…ë¡œë“œ ë¡œê·¸ ì¶”ê°€ (êµìœ¡ê³¼ì • í…œí”Œë¦¿)
  let logs = getLogs();
  logs.push({
    dept: meta.dept,
    year: meta.year,
    docNum: meta.docNum,
    kind: "êµìœ¡ê³¼ì •",
    uploadDate: new Date().toISOString()
  });
  saveLogs(logs);

  alert("ì…í•™ì êµìœ¡ê³¼ì • ì—…ë¡œë“œ ì™„ë£Œ!");
  renderDeptList();
  renderUploadHistory();
}

/* ---------------------------
   2) ë³€ê²½ì‚¬ìœ ì„œ(ê³¼ëª©ë³„) ì²˜ë¦¬
--------------------------- */
function processChangeSheet(sh) {
  const rows = XLSX.utils.sheet_to_json(sh, { header: 1 });

  const dept = clean(rows[0]?.[1]);
  const approvedText = clean(rows[1]?.[1]); // í™•ì • / ë¯¸í™•ì •
  const meetingDate = clean(rows[2]?.[1]);
  const docNum = clean(rows[3]?.[1]);

  if (!dept) {
    alert("ë³€ê²½ì‚¬ìœ ì„œì˜ í•™ê³¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // í—¤ë” ìœ„ì¹˜ ì°¾ê¸°
  let start = -1;
  for (let i = 0; i < rows.length; i++) {
    if (rows[i][0] === "(ë³€ê²½í• )êµìœ¡ê³¼ì • ì—°ë„") {
      start = i;
      break;
    }
  }
  if (start === -1) {
    alert("ë³€ê²½ì‚¬ìœ ì„œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n'(ë³€ê²½í• )êµìœ¡ê³¼ì • ì—°ë„' í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const dataRows = rows
    .slice(start + 1)
    .filter(r => r.some(c => c !== undefined && c !== null && c !== ""));

  let all = getData();
  let appliedCount = 0;
  const notFound = [];
  const yearsSet = new Set();

  dataRows.forEach(r => {
    const year = clean(r[0]);
    if (!year) return;
    yearsSet.add(year);

    // (ì „) ì •ë³´
    const prev = {
      year,
      grade: r[1], semester: r[2], type: r[3], name: r[4],
      credit: r[5], total: r[6], theory: r[7], practice: r[8], skill: r[9], experiment: r[10]
    };
    const reason = clean(r[11]);

    // (í›„) ì •ë³´
    const next = {
      year,
      grade: r[12], semester: r[13], type: r[14], name: r[15],
      credit: r[16], total: r[17], theory: r[18], practice: r[19], skill: r[20], experiment: r[21]
    };

    const beforeName = clean(prev.name);
    const afterName = clean(next.name);
    const baseName = beforeName || afterName;

    // í•´ë‹¹ í•™ê³¼Â·ì—°ë„ ìµœì‹  êµìœ¡ê³¼ì • ì°¾ê¸°
    const candidates = all.filter(d => d.dept === dept && same(d.year, year));
    if (!candidates.length) {
      notFound.push(`(${year}) ${baseName || "êµê³¼ëª©ëª… ì—†ìŒ"} - í•´ë‹¹ ì—°ë„ êµìœ¡ê³¼ì • ì—†ìŒ`);
      return;
    }
    candidates.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
    const entry = candidates[0];

    if (!entry.data || !Array.isArray(entry.data)) return;

    // ê¸°ì¡´ ê³¼ëª© ì°¾ê¸°
    let idx = -1;
    if (baseName) {
      idx = entry.data.findIndex(row =>
        same(row["êµê³¼ëª©ëª…"], baseName)
      );
    }

    // ê¸°ì¡´ ê³¼ëª©ì´ ì—†ìœ¼ë©´ -> ì‹ ê·œ ê³¼ëª©ìœ¼ë¡œ ì¶”ê°€
    if (idx === -1) {
      if (!afterName) {
        notFound.push(`(${year}) (ì‹ ê·œ) êµê³¼ëª©ëª… ì—†ìŒ - ì¶”ê°€ ë¶ˆê°€`);
        return;
      }
      const newSubject = {
        "ê°œì„¤í•™ë…„": next.grade || "",
        "ê°œì„¤í•™ê¸°": next.semester || "",
        "ì´ìˆ˜êµ¬ë¶„": next.type || "",
        "êµê³¼ëª©ëª…": afterName || "",
        "í•™ì ": next.credit || "",
        "ì´ì‹œìˆ˜": next.total || "",
        "ì´ë¡ ì‹œìˆ˜": next.theory || "",
        "ì‹¤ìŠµì‹œìˆ˜": next.practice || "",
        "ì‹¤ê¸°ì‹œìˆ˜": next.skill || "",
        "ì‹¤í—˜ì‹œìˆ˜": next.experiment || "",
        "ìˆ˜ì¤€": "",
        "ë¹„ê³ ": ""
      };
      entry.data.push(newSubject);

      // ë³€ê²½ ë©”ëª¨(ì¶”ê°€)
      if (!entry.changes) entry.changes = [];
      entry.changes.push({
        type: "ì¶”ê°€",
        subject: afterName,
        detail: { ...newSubject },
        beforeName,
        afterName,
        reason,
        changeDocNum: docNum,
        changeDate: meetingDate || new Date().toISOString().slice(0, 10),
        year
      });

      // í™•ì • ì—¬ë¶€ / íšŒì˜ì¼ ë°˜ì˜
      if (approvedText) entry.approved = (approvedText === "í™•ì •");
      if (meetingDate) entry.meetingDate = meetingDate;

      appliedCount++;
      return;
    }

    // ê¸°ì¡´ ê³¼ëª©ì´ ìˆìœ¼ë©´ -> ë³€ê²½ ë°˜ì˜
    const beforeRow = { ...entry.data[idx] };
    const updated = { ...beforeRow };

    function applyField(fieldName, newValue) {
      if (newValue !== undefined && newValue !== null && newValue !== "") {
        updated[fieldName] = newValue;
      }
    }

    applyField("ê°œì„¤í•™ë…„", next.grade);
    applyField("ê°œì„¤í•™ê¸°", next.semester);
    applyField("ì´ìˆ˜êµ¬ë¶„", next.type);
    applyField("êµê³¼ëª©ëª…", afterName || beforeName);
    applyField("í•™ì ", next.credit);
    applyField("ì´ì‹œìˆ˜", next.total);
    applyField("ì´ë¡ ì‹œìˆ˜", next.theory);
    applyField("ì‹¤ìŠµì‹œìˆ˜", next.practice);
    applyField("ì‹¤ê¸°ì‹œìˆ˜", next.skill);
    applyField("ì‹¤í—˜ì‹œìˆ˜", next.experiment);

    entry.data[idx] = updated;

    const detail = {};
    ["ê°œì„¤í•™ë…„","ê°œì„¤í•™ê¸°","ì´ìˆ˜êµ¬ë¶„","êµê³¼ëª©ëª…","í•™ì ",
     "ì´ì‹œìˆ˜","ì´ë¡ ì‹œìˆ˜","ì‹¤ìŠµì‹œìˆ˜","ì‹¤ê¸°ì‹œìˆ˜","ì‹¤í—˜ì‹œìˆ˜"].forEach(f => {
      const oldVal = beforeRow[f] ?? "";
      const newVal = updated[f] ?? "";
      if (!same(oldVal, newVal)) {
        detail[f] = { before: oldVal, after: newVal };
      }
    });

    if (!entry.changes) entry.changes = [];
    if (Object.keys(detail).length > 0) {
      entry.changes.push({
        type: "ë³€ê²½",
        subject: afterName || beforeName,
        detail: { ...detail },
        beforeName,
        afterName: afterName || beforeName,
        reason,
        changeDocNum: docNum,
        changeDate: meetingDate || new Date().toISOString().slice(0, 10),
        year
      });
    }

    // í™•ì • ì—¬ë¶€ / íšŒì˜ì¼ ë°˜ì˜
    if (approvedText) entry.approved = (approvedText === "í™•ì •");
    if (meetingDate) entry.meetingDate = meetingDate;

    appliedCount++;
  });

  saveData(all);

  // ì—…ë¡œë“œ ë¡œê·¸ ì¶”ê°€ (ë³€ê²½ì‚¬ìœ ì„œ)
  let logs = getLogs();
  const yearsStr = Array.from(yearsSet).join(", ");
  logs.push({
    dept,
    year: yearsStr,
    docNum: docNum || "",
    kind: "ë³€ê²½ì‚¬ìœ ì„œ",
    uploadDate: new Date().toISOString()
  });
  saveLogs(logs);

  let msg = `ë³€ê²½ì‚¬ìœ ì„œ ì ìš© ì™„ë£Œ: ${appliedCount}ê°œ ê³¼ëª© ë°˜ì˜`;
  if (notFound.length) {
    msg += `\n\në‹¤ìŒ ê³¼ëª©ì€ ë°˜ì˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:\n- ` + notFound.join("\n- ");
  }
  alert(msg);

  renderUploadHistory();
}

/* ---------------------------
   ë³€ê²½ë‚´ì—­ ë¹„êµ (ì…í•™ì êµìœ¡ê³¼ì • í…œí”Œë¦¿ìš©)
--------------------------- */
function compare(prev, next) {
  const changes = [];
  const prevMap = {};
  const nextMap = {};

  prev.forEach(i => {
    const name = clean(i["êµê³¼ëª©ëª…"]);
    if (name) prevMap[name] = i;
  });
  next.forEach(i => {
    const name = clean(i["êµê³¼ëª©ëª…"]);
    if (name) nextMap[name] = i;
  });

  // ì¶”ê°€ ë° ë³€ê²½
  Object.keys(nextMap).forEach(subj => {
    if (!prevMap[subj]) {
      changes.push({ type: "ì¶”ê°€ë¨", subject: subj, after: nextMap[subj] });
    } else {
      const diff = {};
      const a = nextMap[subj];
      const b = prevMap[subj];

      Object.keys(a).forEach(k => {
        const oldVal = b[k] ?? "";
        const newVal = a[k] ?? "";
        if (!same(oldVal, newVal)) {
          diff[k] = { before: oldVal, after: newVal };
        }
      });

      if (Object.keys(diff).length > 0) {
        changes.push({ type: "ë³€ê²½ë¨", subject: subj, detail: diff });
      }
    }
  });

  // ì‚­ì œ
  Object.keys(prevMap).forEach(subj => {
    if (!nextMap[subj]) {
      changes.push({ type: "ì‚­ì œë¨", subject: subj, before: prevMap[subj] });
    }
  });

  return changes;
}

/* ---------------------------
   í•™ê³¼ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
--------------------------- */
function renderDeptList() {
  const ul = document.getElementById("deptList");
  ul.innerHTML = "";

  TOP_DEPTS.forEach(d => {
    ul.innerHTML += `
      <li class="border rounded-lg px-4 py-3 hover:bg-gray-50">
        <a href="./dept/${d}.html" class="flex justify-between">
          <span class="font-semibold">${d}</span>
          <span class="text-blue-600 text-sm">ë³´ê¸°</span>
        </a>
      </li>
    `;
  });
}

/* ---------------------------
   ì—…ë¡œë“œ ê¸°ë¡ ë Œë”ë§ (êµìœ¡ê³¼ì • + ë³€ê²½ì‚¬ìœ ì„œ)
--------------------------- */
function renderUploadHistory() {
const originalLogs = getLogs();

// ì›ë³¸ ì¸ë±ìŠ¤ í•¨ê»˜ ì €ì¥ í›„ ì •ë ¬
const logs = originalLogs
  .map((log, i) => ({ ...log, _originalIndex: i }))
  .sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));


  const tbody = document.getElementById("uploadHistory");
  tbody.innerHTML = "";

  logs.forEach((e, idx) => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td class="border px-2 py-1">${e.dept || ""}</td>
      <td class="border px-2 py-1">${e.year || ""}</td>
      <td class="border px-2 py-1">${e.docNum || ""}</td>
      <td class="border px-2 py-1">${e.kind || ""}</td>
      <td class="border px-2 py-1">${e.uploadDate ? new Date(e.uploadDate).toLocaleString() : ""}</td>
      <td class="border px-2 py-1 text-center">
        <button onclick="deleteEntry(${e._originalIndex})"
                class="text-red-600 hover:text-red-800 text-sm">
          ğŸ—‘ ì‚­ì œ
        </button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

/* ---------------------------
   ì—…ë¡œë“œ ê¸°ë¡ ì‚­ì œ
--------------------------- */
function deleteEntry(logIndex) {
  const logs = getLogs();
  const target = logs[logIndex];
  if (!target) return;

  const msg = target.kind === "êµìœ¡ê³¼ì •"
    ? "í•´ë‹¹ ì—…ë¡œë“œ ê¸°ë¡ê³¼ êµìœ¡ê³¼ì • ë°ì´í„°ë¥¼ í•¨ê»˜ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
    : "í•´ë‹¹ ì—…ë¡œë“œ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ë¯¸ ë°˜ì˜ëœ êµìœ¡ê³¼ì • ë³€ê²½ ë‚´ìš©ì€ ìœ ì§€ë©ë‹ˆë‹¤.)";

  if (!confirm(msg)) return;

  // êµìœ¡ê³¼ì • í…œí”Œë¦¿ì¸ ê²½ìš° curriculumDataì—ì„œë„ ì‚­ì œ
  if (target.kind === "êµìœ¡ê³¼ì •") {
  let all = getData();

  // ğŸ”¥ í•µì‹¬: ë™ì¼ í•™ê³¼ + ë™ì¼ ì…í•™ë…„ë„ ëª¨ë“  entry ì‚­ì œ
  all = all.filter(e =>
    !(e.dept === target.dept && same(e.year, target.year))
  );

  saveData(all);
}

  // ë¡œê·¸ì—ì„œ ì œê±°
  logs.splice(logIndex, 1);
  saveLogs(logs);

  renderUploadHistory();
}

/* ì´ˆê¸° ì‹¤í–‰ */
renderDeptList();
renderUploadHistory();

</script>

</body>
</html>
