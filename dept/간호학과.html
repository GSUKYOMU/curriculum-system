<!DOCTYPE html> <html lang="ko"> <head> <meta charset="UTF-8"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <title>ê°„í˜¸í•™ê³¼ ì…í•™ì êµìœ¡ê³¼ì • (ì¡°íšŒ ì „ìš©)</title> <!-- TailwindCSS --> <script src="https://cdn.tailwindcss.com"></script> <!-- SheetJS --> <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script> <style> .strike-delete { text-decoration: line-through; color: #d00000; font-weight: bold; } </style> </head> <body class="bg-gray-100 min-h-screen"> <div class="max-w-6xl mx-auto py-8 px-4"> <a href="../index.html" class="text-blue-600 text-sm">&larr; ë©”ì¸ìœ¼ë¡œ</a> <h1 class="text-3xl font-bold mt-2 mb-4">ê°„í˜¸í•™ê³¼ ì…í•™ì êµìœ¡ê³¼ì • (ì¡°íšŒ ì „ìš©)</h1> <!-- ì¡°íšŒ ì „ìš© ì•ˆë‚´ --> <div class="bg-white rounded-xl shadow p-4 mb-6"> <p class="text-gray-700"> ì´ í˜ì´ì§€ëŠ” <strong>ì¡°íšŒ ì „ìš©</strong>ì…ë‹ˆë‹¤.<br/> êµìœ¡ê³¼ì • ë° ë³€ê²½ì‚¬ìœ ì„œ ì—…ë¡œë“œëŠ” <strong>index.html</strong>ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p> </div> <!-- ê³¼ì • ì„ íƒ --> <div class="bg-white rounded-xl shadow p-4 mb-6"> <h2 class="text-xl font-semibold mb-3">ê³¼ì • ì„ íƒ</h2> <div id="trackButtons" class="flex flex-wrap gap-2"></div> </div> <!-- ì…í•™ë…„ë„ ì„ íƒ ë° ë‹¤ìš´ë¡œë“œ --> <div class="bg-white rounded-xl shadow p-4"> <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 gap-2"> <h2 class="text-xl font-semibold">ì…í•™ë…„ë„ë³„ ìµœì¢… êµìœ¡ê³¼ì •</h2> <div id="yearButtons" class="flex flex-wrap gap-2 text-sm"></div> </div> <button onclick="downloadExcel()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-4 text-sm"> ğŸ“¥ í˜„ì¬ êµìœ¡ê³¼ì • ì—‘ì…€ ë‹¤ìš´ë¡œë“œ </button> <div id="noData" class="text-gray-500 text-sm hidden"> ì„ íƒí•œ ê³¼ì • / ì…í•™ë…„ë„ì— í•´ë‹¹í•˜ëŠ” êµìœ¡ê³¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. </div> <div class="overflow-x-auto"> <table class="min-w-full text-sm border" id="curriculumTable"> <thead class="bg-gray-100"> <tr> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(0)">ê°œì„¤í•™ë…„</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(1)">ê°œì„¤í•™ê¸°</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(2)">êµê³¼ëª©ëª…</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(3)">í•™ì </th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(4)">ì´ì‹œìˆ˜</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(5)">ì´ë¡ </th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(6)">ì‹¤ìŠµ</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(7)">ì‹¤í—˜</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(8)">ì‹¤ê¸°</th> <th class="border px-2 py-1 cursor-pointer" onclick="sortTable(9)">ë¹„ê³ </th> </tr> </thead> <tbody id="curriculumBody"></tbody> </table> </div> </div> </div> <!-- ë³€ê²½ë‚´ì—­ íŒ¨ë„ --> <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden"></div> <div id="changePanel" class="fixed top-0 right-0 h-full w-full md:w-1/3 bg-white shadow-xl transform translate-x-full transition-transform duration-200"> <div class="p-4 border-b flex items-center justify-between"> <h3 class="text-lg font-semibold">ë³€ê²½ ë‚´ì—­</h3> <button onclick="closeChangePanel()" class="text-sm text-gray-500">ë‹«ê¸°</button> </div> <div id="changeContent" class="p-4 text-sm overflow-y-auto"></div> </div> <script> /* ------------------------- ê³µí†µ ìœ í‹¸ -------------------------- */ const STORAGE_KEY = "curriculumData"; const DEPT_NAME = "ê°„í˜¸í•™ê³¼"; function clean(v) { return (v || "") .toString() .normalize("NFKC") .replace(/\s+/g, " ") .trim(); } function same(a, b) { return clean(a) === clean(b); } function getData() { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); } catch (e) { return []; } } /* =========================================================== PART A: index.htmlì—ì„œ ì—…ë¡œë“œí•œ ë°ì´í„°ë§Œ ì½ê¸° =========================================================== */ /* ê°„í˜¸í•™ê³¼ í˜ì´ì§€ì—ì„œëŠ” ì—…ë¡œë“œ ê¸°ëŠ¥ ì—†ìŒ â†’ index.htmlì—ì„œ ì €ì¥í•œ curriculumDataë§Œ ì‚¬ìš© */ let selectedTrack = DEPT_NAME; let selectedYear = null; let currentEntries = []; let currentEntry = null; let sortState = {}; function initTrackButtons() { const c = document.getElementById("trackButtons"); c.innerHTML = ""; const btn = document.createElement("button"); btn.textContent = DEPT_NAME; btn.className = "px-3 py-1 rounded-full border text-sm bg-blue-600 text-white"; btn.onclick = () => { selectedTrack = DEPT_NAME; selectedYear = null; loadEntries(); }; c.appendChild(btn); } /* =========================================================== PART B: ê°„í˜¸í•™ê³¼ ë°ì´í„°ë§Œ í•„í„°ë§í•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸° =========================================================== */ function loadEntries() { const all = getData(); const filtered = all.filter(d => d.dept === selectedTrack); // ë™ì¼ í•™ë…„ë„ëŠ” ê°€ì¥ ìµœì‹  uploadDate ê¸°ì¤€ìœ¼ë¡œ 1ê°œë§Œ ë‚¨ê¸°ê¸° const map = {}; filtered.forEach(e => { if (!map[e.year] || map[e.year].uploadDate < e.uploadDate) { map[e.year] = e; } }); currentEntries = Object.values(map).sort((a, b) => a.year.localeCompare(b.year) ); renderYearButtons(); } /* =========================================================== PART C: ì…í•™ë…„ë„ ë²„íŠ¼ ë Œë”ë§ =========================================================== */ function renderYearButtons() { const c = document.getElementById("yearButtons"); c.innerHTML = ""; if (!currentEntries.length) { document.getElementById("noData").classList.remove("hidden"); return; } document.getElementById("noData").classList.add("hidden"); if (!selectedYear) selectedYear = currentEntries[0].year; currentEntries.forEach(e => { const btn = document.createElement("button"); btn.textContent = e.year + " ì…í•™ì"; btn.className = "px-3 py-1 rounded-full border text-sm " + (e.year === selectedYear ? "bg-indigo-600 text-white" : "bg-white text-gray-700"); if (e.changes && e.changes.length > 0) { const mark = document.createElement("span"); mark.textContent = "ë³€ê²½ ìˆìŒ"; mark.className = "text-red-500 text-xs ml-1"; btn.appendChild(mark); } btn.onclick = () => { selectedYear = e.year; renderYearButtons(); }; c.appendChild(btn); }); renderCurriculum(); } /* =========================================================== PART D: ë³€ê²½ë‚´ì—­ ë§¤í•‘ (ê³¼ëª©ëª… ê¸°ì¤€) =========================================================== */ function buildChangeMap(changes) { const map = {}; (changes || []).forEach(ch => { const keys = [ clean(ch.subject), clean(ch.beforeName), clean(ch.afterName) ]; keys.forEach(k => { if (k) { if (!map[k]) map[k] = []; map[k].push(ch); } }); }); return map; } /* =========================================================== PART E: êµìœ¡ê³¼ì • í…Œì´ë¸” ë Œë”ë§ =========================================================== */ function renderCurriculum() { currentEntry = currentEntries.find(e => e.year === selectedYear); const tbody = document.getElementById("curriculumBody"); tbody.innerHTML = ""; if (!currentEntry) return; const changes = currentEntry.changes || []; const changeMap = buildChangeMap(changes); (currentEntry.data || []).forEach(row => { let subject = clean(row["êµê³¼ëª©ëª…"]); const changed = !!changeMap[subject]; const isDeleted = row._deleted; const tr = document.createElement("tr"); const cells = [ row["ê°œì„¤í•™ë…„"], row["ê°œì„¤í•™ê¸°"], row["êµê³¼ëª©ëª…"], row["í•™ì "], row["ì´ì‹œìˆ˜"], row["ì´ë¡ ì‹œìˆ˜"], row["ì‹¤ìŠµì‹œìˆ˜"], row["ì‹¤í—˜ì‹œìˆ˜"], row["ì‹¤ê¸°ì‹œìˆ˜"], row["ë¹„ê³ "] ]; cells.forEach((v, idx) => { const td = document.createElement("td"); td.className = "border px-2 py-1 whitespace-nowrap"; if (idx === 2) { if (isDeleted) { td.innerHTML = <span class="strike-delete">${v} (ì‚­ì œë¨)</span>; } else if (changed) { td.innerHTML = <button class="bg-yellow-100 border border-yellow-300 text-yellow-800 text-xs px-2 py-0.5 rounded-full" onclick="openChangePanel('${subject}')">${v} ë³€ê²½ë‚´ì—­</button>; } else { td.textContent = v || ""; } } else { if (isDeleted) td.classList.add("strike-delete"); td.textContent = v || ""; } tr.appendChild(td); }); if (changed && !isDeleted) tr.classList.add("bg-yellow-50"); tbody.appendChild(tr); }); } /* =========================================================== PART F: ì •ë ¬ ê¸°ëŠ¥ =========================================================== */ function sortTable(colIndex) { if (!currentEntry) return; const current = sortState[colIndex] || "asc"; const next = current === "asc" ? "desc" : "asc"; sortState[colIndex] = next; const keys = [ "ê°œì„¤í•™ë…„","ê°œì„¤í•™ê¸°","êµê³¼ëª©ëª…","í•™ì ","ì´ì‹œìˆ˜", "ì´ë¡ ì‹œìˆ˜","ì‹¤ìŠµì‹œìˆ˜","ì‹¤í—˜ì‹œìˆ˜","ì‹¤ê¸°ì‹œìˆ˜","ë¹„ê³ " ]; const key = keys[colIndex]; currentEntry.data.sort((a, b) => { let v1 = a[key] ?? ""; let v2 = b[key] ?? ""; const n1 = parseFloat(v1); const n2 = parseFloat(v2); if (!isNaN(n1) && !isNaN(n2)) { return next === "asc" ? n1 - n2 : n2 - n1; } return next === "asc" ? clean(v1).localeCompare(clean(v2)) : clean(v2).localeCompare(clean(v1)); }); renderCurriculum(); } /* =========================================================== PART G: ë³€ê²½ë‚´ì—­ íŒ¨ë„ =========================================================== */ function openChangePanel(subjectKey) { const norm = clean(subjectKey); const entries = (currentEntry.changes || []).filter(ch => { return same(ch.subject, norm) || same(ch.beforeName, norm) || same(ch.afterName, norm); }); const content = document.getElementById("changeContent"); content.innerHTML = <h4 class="font-semibold mb-3">êµê³¼ëª©: ${subjectKey}</h4>; entries.forEach(ch => { let typeLabel = ""; if (ch.type === "ì¶”ê°€") { typeLabel = <p class="text-green-700 font-semibold mb-2">ğŸ†• ì‹ ê·œ ê°œì„¤</p>; } else if (ch.type === "ì‚­ì œ") { typeLabel = <p class="text-red-700 font-semibold mb-2">âŒ ì‚­ì œë¨</p>; } else { typeLabel = <p class="text-amber-700 font-semibold mb-2">âœï¸ ë‚´ìš© ë³€ê²½</p>; } let detailHTML = ""; if (ch.detail && Object.keys(ch.detail).length > 0) { detailHTML += <table class="text-xs w-full border mb-3"> <thead> <tr class="bg-gray-100"> <th class="border px-1 py-0.5">í•­ëª©</th> <th class="border px-1 py-0.5">ë³€ê²½ ì „</th> <th class="border px-1 py-0.5">ë³€ê²½ í›„</th> </tr> </thead> <tbody>; Object.keys(ch.detail).forEach(k => { detailHTML += <tr> <td class="border px-1 py-0.5">${k}</td> <td class="border px-1 py-0.5">${ch.detail[k].before || ""}</td> <td class="border px-1 py-0.5">${ch.detail[k].after || ""}</td> </tr>; }); detailHTML += "</tbody></table>"; } content.innerHTML += <div class="mb-4 pb-4 border-b"> ${typeLabel} ${detailHTML} <p class="text-xs text-gray-600 mt-2">ğŸ“„ ë³€ê²½ì‚¬ìœ :</p> <p class="text-xs mb-2">${ch.reason || "-"}</p> <p class="text-xs text-gray-500">ë¬¸ì„œë²ˆí˜¸: ${ch.changeDocNum || "-"}</p> <p class="text-xs text-gray-500">íšŒì˜ì¼: ${ch.changeDate || "-"}</p> </div> ; }); document.getElementById("overlay").classList.remove("hidden"); document.getElementById("changePanel").classList.remove("translate-x-full"); document.getElementById("overlay").onclick = closeChangePanel; } function closeChangePanel() { document.getElementById("overlay").classList.add("hidden"); document.getElementById("changePanel").classList.add("translate-x-full"); } /* =========================================================== PART H: Excel ë‹¤ìš´ë¡œë“œ =========================================================== */ function downloadExcel() { if (!currentEntry) { alert("ë‹¤ìš´ë¡œë“œí•  êµìœ¡ê³¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."); return; } const wb = XLSX.utils.book_new(); const rows = [ ["í•™ê³¼ëª…", currentEntry.dept], ["ì…í•™ë…„ë„", currentEntry.year], ["ë¬¸ì„œë²ˆí˜¸", currentEntry.docNum], ["êµìœ¡ê³¼ì •ìœ„ì›íšŒ í™•ì •ì—¬ë¶€", currentEntry.approved ? "í™•ì •" : "ë¯¸í™•ì •"], ["êµìœ¡ê³¼ì •ìœ„ì›íšŒ ê°œìµœì¼", currentEntry.meetingDate || ""], [], [ "ê°œì„¤í•™ë…„","ê°œì„¤í•™ê¸°","êµê³¼ëª©ëª…", "í•™ì ","ì´ì‹œìˆ˜","ì´ë¡ ì‹œìˆ˜","ì‹¤ìŠµì‹œìˆ˜","ì‹¤í—˜ì‹œìˆ˜","ì‹¤ê¸°ì‹œìˆ˜","ë¹„ê³ " ] ]; (currentEntry.data || []).forEach(r => { rows.push([ r["ê°œì„¤í•™ë…„"], r["ê°œì„¤í•™ê¸°"], r["êµê³¼ëª©ëª…"], r["í•™ì "], r["ì´ì‹œìˆ˜"], r["ì´ë¡ ì‹œìˆ˜"], r["ì‹¤ìŠµì‹œìˆ˜"], r["ì‹¤í—˜ì‹œìˆ˜"], r["ì‹¤ê¸°ì‹œìˆ˜"], r["ë¹„ê³ "] ]); }); const ws = XLSX.utils.aoa_to_sheet(rows); XLSX.utils.book_append_sheet(wb, ws, "êµìœ¡ê³¼ì •"); const filename = ${currentEntry.dept}_${currentEntry.year}_ì…í•™ìêµìœ¡ê³¼ì •.xlsx; XLSX.writeFile(wb, filename); } /* =========================================================== PART I: ì´ˆê¸° ì‹¤í–‰ =========================================================== */ document.addEventListener("DOMContentLoaded", () => { initTrackButtons(); loadEntries(); }); </script> </body> </html>
